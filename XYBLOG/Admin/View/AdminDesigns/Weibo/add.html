<extend name="base/admin" />

<block name="content">
    <!-- Start: Content-Wrapper -->
    <section id="content_wrapper">
        <include file="base/topbar-dropmenu" />

        <!-- Start: Topbar -->
        <header id="topbar">
            <div class="topbar-left">
                <ol class="breadcrumb">
                    <li class="crumb-active">
                        <a href="{:U('Admin/Index/index')}">管理后台</a>
                    </li>
                    <li class="crumb-icon">
                        <a href="{:U('Admin/Index/index')}">
                            <span class="glyphicon glyphicon-home"></span>
                        </a>
                    </li>
                    <li class="crumb-link">
                        <a href="{:U('Admin/Weibo/index')}">微博管理</a>
                    </li>
                    <li class="crumb-trail">新微博</li>
                </ol>
            </div>
            <div class="topbar-right">
                <div class="ib topbar-dropdown">
                    <label for="topbar-multiple" class="control-label pr10 fs11 text-muted">Reporting Period</label>
                    <select id="topbar-multiple" class="hidden">
                        <optgroup label="Filter By:">
                            <option value="1-1">Last 30 Days</option>
                            <option value="1-2" selected="selected">Last 60 Days</option>
                            <option value="1-3">Last Year</option>
                        </optgroup>
                    </select>
                </div>
                <div class="ml15 ib va-m" id="toggle_sidemenu_r">
                    <a href="admin_plugins-dock.html#" class="pl5">
                        <i class="fa fa-sign-in fs22 text-primary"></i>
                        <span class="badge badge-hero badge-danger">3</span>
                    </a>
                </div>
            </div>
        </header>
        <!-- End: Topbar -->

        <!-- Begin: Content -->
        <section id="content" class="animated fadeIn">

            <!-- Begin: Content Header -->
            <div class="content-header">
                <h2>发表 <b class="text-primary">微博</b> 到博客</h2>
                <p class="lead">你可以选择消息类型，以获得较好的展示体验。.</p>
            </div>

            <div class="row animated-delay" data-animate='["500","fadeIn"]'>
                <div class="col-md-10 center-block text-center">
                    <div class="row table-layout table-clear-xs">
                        <div class="col-xs-12 col-sm-4 br-a br-light bg-light pv20 ph30 va-t">
                            <h4 class="micro-header">选择消息类型</h4>
                            <div class="row" id="content-type">
                                <div class="col-xs-4 col-sm-6">
                                    <a class="holder-style p15 mb20" href="#dock-image">
                                        <span class="fa fa-picture-o holder-icon"></span>
                                        <br> 图片
                                    </a>
                                </div>
                                <div class="col-xs-4 col-sm-6">
                                    <a class="holder-style p15 mb20" href="#dock-panel">
                                        <span class="fa fa-text-height holder-icon"></span>
                                        <br> 图文
                                    </a>
                                </div>
                                <div class="col-xs-4 col-sm-6">
                                    <a class="holder-style p15 mb20" href="#dock-music">
                                        <span class="fa fa-pencil-square-o holder-icon"></span>
                                        <br> 音乐
                                    </a>
                                </div>
                                <div class="col-xs-4 col-sm-6">
                                    <a class="holder-style p15 mb20  holder-active" href="#dock-location">
                                        <span class="fa fa-map-marker holder-icon"></span>
                                        <br> 位置
                                    </a>
                                </div>
                                <div class="col-xs-4 col-sm-6">
                                    <a class="holder-style p15 mb20" href="#dock-video">
                                        <span class="fa fa-film holder-icon"></span>
                                        <br> 视频
                                    </a>
                                </div>
                                <div class="col-xs-4 col-sm-6">
                                    <a class="holder-style p15 mb20" href="#dock-url">
                                        <span class="fa fa-spinner holder-icon"></span>
                                        <br> 分享
                                    </a>
                                </div>

                            </div>
                            <button id="dock-push" type="button" class="btn btn-success fs14 fw600 pv15 btn-block">发布</button>
                        </div>

                        <div class="col-xs-12 col-sm-8 br-a br-light bg-light dark va-t p10 va-m">
                            <div id="dock-content" class="ph20">
                                <div id="dock-image">
                                    <div class="dock-item" data-title="图片分享">
                                        <div class="admin-form">
                                        <form method="post" action="" id="form-image">
                                            <div class="fileupload fileupload-new" data-provides="fileupload"><input type="hidden">
                                                <div class="fileupload-preview thumbnail mb20" style="line-height: 205px;">
                                                    <img data-src="holder.js/100%x195" alt="100%x195" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNzU4IiBoZWlnaHQ9IjE5NSIgdmlld0JveD0iMCAwIDc1OCAxOTUiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjxkZWZzLz48cmVjdCB3aWR0aD0iNzU4IiBoZWlnaHQ9IjE5NSIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjI4NS41NzAzMTI1IiB5PSI5Ny41IiBzdHlsZT0iZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjM2cHQ7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NzU4eDE5NTwvdGV4dD48L2c+PC9zdmc+" data-holder-rendered="true" style="height: 195px; width: 100%; display: block;">
                                                </div>
                                                <div class="row">
                                                    <div class="col-xs-7 pr5">
                                                        <input type="text" name="name2" id="name2" class="form-control text-center event-name br-light bg-light" placeholder="上传文件名">
                                                        <label for="name2" class="field-icon"></label>
                                                    </div>
                                                    <div class="col-xs-5">
                                                  <span class="btn btn-system btn-file btn-block">
                                                    <span class="fileupload-new">选择</span>
                                                    <span class="fileupload-exists">改变</span>
                                                    <input type="file">
                                                  </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    </div>
                                </div>
                                <div id="dock-panel">
                                    <div class="dock-item" data-title="图文分享">
                                        <div class="admin-form">
                                        <form method="post" action="" id="form-panel">
                                            <div class="fileupload fileupload-new" data-provides="fileupload">
                                                <div class="section">
                                                    <label for="comment" class="field prepend-icon">
                                                        <textarea class="gui-textarea" id="desic" name="desic" placeholder="说点什么"></textarea>
                                                        <label for="comment" class="field-icon">
                                                            <i class="fa fa-comments"></i>
                                                        </label>
                                                        <span class="input-footer"><strong>Tip:</strong>你可以在下面上传配图.</span>
                                                    </label>
                                                </div>
                                                <div class="section">
                                                    <label class="field prepend-icon append-button file">
                                                        <span class="button btn-system">选择图片</span>
                                                        <input type="file" class="gui-file" name="panelFile" id="panelFile" onChange="document.getElementById('panelUploaderImg').value = this.value;">
                                                        <input type="text" class="gui-input" id="panelUploaderImg" placeholder="请选择图片">
                                                        <label class="field-icon">
                                                            <i class="fa fa-upload"></i>
                                                        </label>
                                                    </label>
                                                </div>
                                                <div class="fileupload-preview thumbnail mb20 hide">
                                                    <img data-src="holder.js/100%x100" alt="holder">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    </div>
                                </div>
                                <div id="dock-music">
                                    <div class="dock-item" data-title="音乐分享">
                                        <div class="admin-form">
                                            <div class="panel panel-success heading-border">
                                                <div class="panel-heading bg-white hidden">
                                                    <span class="panel-title"><i class="fa fa-rocket"></i>文字分享</span>
                                                </div>
                                                <!-- end .panel-heading section -->

                                                <form method="post" action="http://admindesigns.com/" id="comment">
                                                    <div class="panel-body p25 pb15">
                                                        <div class="section row">
                                                            <div class="col-md-12">
                                                                <audio src="https://github.com/kolber/audiojs/blob/master/mp3/bensound-buddy.mp3?raw=true" preload="auto" style="width: 100%"/>
                                                            </div>
                                                        </div>
                                                        <!-- end section row section -->
                                                        <div class="section row">
                                                            <div class="col-md-12">
                                                                <label for="email" class="field prepend-icon">
                                                                    <input type="email" name="email" id="email" class="gui-input" placeholder="Music Uri">
                                                                    <label for="email" class="field-icon">
                                                                        <i class="fa fa-envelope"></i>
                                                                    </label>
                                                                </label>
                                                            </div>

                                                        </div>
                                                        <!-- end section row section -->

                                                        <div class="section">
                                                            <label for="comment" class="field prepend-icon">
                                                                <textarea class="gui-textarea" id="comment" name="comment" placeholder="Your comment"></textarea>
                                                                <label for="comment" class="field-icon">
                                                                    <i class="fa fa-comments"></i>
                                                                </label>
                                                                <span class="input-footer"><strong>TIP:</strong>随便说些什么吧！.</span>
                                                            </label>
                                                        </div>
                                                        <!-- end section -->

                                                    </div>
                                                    <!-- end .form-body section -->

                                                    <div class="panel-footer hidden">
                                                        <button type="submit" class="button btn-primary">Post Comment</button>
                                                    </div>
                                                    <!-- end .form-footer section -->
                                                </form>
                                            </div>
                                            <!-- end: .panel -->
                                        </div>
                                    </div>
                                </div>
                                <div id="dock-location" class="active-content">
                                    <div class="dock-item" data-title="位置分享">
                                        <div class="admin-form">
                                            <div class="panel panel-success heading-border">
                                                <div class="panel-heading bg-white hidden">
                                                    <span class="panel-title"><i class="fa fa-rocket"></i>分享位置</span>
                                                </div>
                                                <form method="post" action="__SELF__" id="weibo-location">
                                                    <input type="hidden" name="Lng" value="">
                                                    <input type="hidden" name="Lat" value="">
                                                    <div class="panel-body p25 pb15">
                                                        <div class="section">
                                                            <label for="comment" class="field prepend-icon">
                                                                <textarea class="gui-textarea" id="location-comment" name="comment" placeholder="说些什么"></textarea>
                                                                <label for="comment" class="field-icon">
                                                                    <i class="fa fa-comments"></i>
                                                                </label>
                                                                <span class="input-footer"><strong>TIP:</strong>这里又发生了什么呢？</span>
                                                            </label>
                                                        </div>
                                                        <div class="section row">
                                                            <div class="col-md-12">
                                                                <label for="location-name" class="field prepend-icon">
                                                                    <input type="url" name="location-name" id="location-name" class="gui-input" placeholder="">
                                                                    <label for="location-name" class="field-icon">
                                                                        <i class="fa fa-globe"></i>
                                                                    </label>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="section row">
                                                            <div class="col-md-12">
                                                                <div class="thumbnail mb20">
                                                                    <div id="location" style="height: 400px"></div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <!-- end .form-body section -->

                                                    <div class="panel-footer hidden">
                                                        <button type="submit" class="button btn-primary">Post Comment</button>
                                                    </div>
                                                    <!-- end .form-footer section -->
                                                </form>

                                            </div>
                                            <!-- end: .panel -->
                                        </div>
                                    </div>
                                </div>
                                <div id="dock-video">
                                    <div class="dock-item" data-title="视频分享">
                                        <p class="fs15 mt10 mb20 ph20"> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                                        <p class="fs15 mb20 ph20"> Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum </p>
                                    </div>
                                </div>
                                <div id="dock-url">
                                    <div class="dock-item" data-title="链接分享">
                                        <div class="embed-responsive embed-responsive-16by9">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- End: Content -->
    </section>
</block>

<block name="script">
    <script type="text/javascript"
            src="http://webapi.amap.com/maps?v=1.3&key=cbcca1a233790a6e219860792cf43e8f"></script>
    <!-- FileUpload Plugin -->
    <script src="__PUBLIC__/vendor/plugins/plupload/js/plupload.min.js"></script>
    <script src="__PUBLIC__/vendor/qiniujs/dist/qiniu.min.js"></script>
    <script src="__PUBLIC__/vendor/plugins/audiojs/audio.min.js"></script>
    <script src="__PUBLIC__/vendor/plugins/holder/holder.min.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            "use strict";
            Core.init();
            Demo.init();
            var contentType = $('#content-type');
            var Content = $('#dock-content');
            contentType.on('click', '.holder-style', function(e) {
                e.preventDefault();

                var This = $(this);
                var activeContent = This.attr('href');
                contentType.find('.holder-style').removeClass('holder-active');
                This.addClass('holder-active');
                Content.children('div').removeClass('active-content');
                $(activeContent).addClass('active-content');
            });

            $('#dock-push').on('click', function() {

                var findPush = Content.children('.active-content').find('.dock-item');

                // Admin Dock Plugin
                findPush.dockmodal({
                    minimizedWidth: 220,
                    height: 430,
                    title: function() {
                        // note this is a panel specific callback
                        // will return undefined if nonexistant
                        return this.data('title');
                    },
                    initialState: "minimized"
                });
            });

            //地图初始化
            function initMap(){
                var map = new AMap.Map("location", {
                    resizeEnable: true
                });
                //为地图注册click事件获取鼠标点击出的经纬度坐标
                var clickEventListener = map.on('click', function(e) {
                    console.log(e);
                    //document.getElementById("lnglat").value = e.lnglat.getLng() + ',' + e.lnglat.getLat()
                    $('[name=Lng]').val(e.lnglat.getLng());
                    $('[name=Lat]').val(e.lnglat.getLat());

                    var InglatXY = [e.lnglat.getLng(),e.lnglat.getLat()];
                    //获取具体地址
                    AMap.service(["AMap.Geocoder"], function() { //加载地理编码
                        var geocoder = new AMap.Geocoder({
                            radius: 1000,
                            extensions: "all"
                        });
                        //步骤三：通过服务对应的方法回调服务返回结果，本例中通过逆地理编码方法getAddress回调结果
                        geocoder.getAddress(new AMap.LngLat(e.lnglat.getLng(),e.lnglat.getLat()), function(status, result){
                            //根据服务请求状态处理返回结果
                            if(status=='error') {
                                alert("服务请求出错啦！ ");
                            }
                            if(status=='no_data') {
                                alert("无数据返回，请换个关键字试试～～");
                            }
                            else {
                                console.log(result);
                                $('[name=location-name]').val(result.regeocode.formattedAddress);
                            }
                        });
                    });
                });
                map.plugin(["AMap.Autocomplete"],function() {
                    var auto = new AMap.Autocomplete({
                        input: "tipinput"
                    });
                    AMap.event.addListener(auto, "select", select);//注册监听，当选中某条记录时会触发
                    function select(e) {
                        if (e.poi && e.poi.location) {
                            map.setZoom(15);
                            console.log(e);
                            map.setCenter(e.poi.location);
                        }
                    }
                });
            }
            initMap();


            audiojs.events.ready(function() {
                var as = audiojs.createAll();
            });

            //文件上传
            var uploader = Qiniu.uploader({
                runtimes: 'html5,flash,html4',    //上传模式,依次退化
                browse_button: '.append-button',       //上传选择的点选按钮，**必需**
                uptoken_url: '/token',
                //Ajax请求upToken的Url，**强烈建议设置**（服务端提供）
                // uptoken : '<Your upload token>',
                //若未指定uptoken_url,则必须指定 uptoken ,uptoken由其他程序生成
                // unique_names: true,
                // 默认 false，key为文件名。若开启该选项，SDK会为每个文件自动生成key（文件名）
                // save_key: true,
                // 默认 false。若在服务端生成uptoken的上传策略中指定了 `sava_key`，则开启，SDK在前端将不对key进行任何处理
                domain: 'http://qiniu-plupload.qiniudn.com/',
                //bucket 域名，下载资源时用到，**必需**
                container: 'container',           //上传区域DOM ID，默认是browser_button的父元素，
                max_file_size: '100mb',           //最大文件体积限制
                flash_swf_url: 'js/plupload/Moxie.swf',  //引入flash,相对路径
                max_retries: 3,                   //上传失败最大重试次数
                dragdrop: true,                   //开启可拖曳上传
                drop_element: 'container',        //拖曳上传区域元素的ID，拖曳文件或文件夹后可触发上传
                chunk_size: '4mb',                //分块上传时，每片的体积
                auto_start: true,                 //选择文件后自动上传，若关闭需要自己绑定事件触发上传
                init: {
                    'FilesAdded': function(up, files) {
                        plupload.each(files, function(file) {
                            // 文件添加进队列后,处理相关的事情
                        });
                    },
                    'BeforeUpload': function(up, file) {
                        // 每个文件上传前,处理相关的事情
                    },
                    'UploadProgress': function(up, file) {
                        // 每个文件上传时,处理相关的事情
                    },
                    'FileUploaded': function(up, file, info) {
                        // 每个文件上传成功后,处理相关的事情
                        // 其中 info 是文件上传成功后，服务端返回的json，形式如
                        // {
                        //    "hash": "Fh8xVqod2MQ1mocfI4S4KpRL6D98",
                        //    "key": "gogopher.jpg"
                        //  }
                        // 参考http://developer.qiniu.com/docs/v6/api/overview/up/response/simple-response.html
                        // var domain = up.getOption('domain');
                        // var res = parseJSON(info);
                        // var sourceLink = domain + res.key; 获取上传成功后的文件的Url
                    },
                    'Error': function(up, err, errTip) {
                        //上传出错时,处理相关的事情
                    },
                    'UploadComplete': function() {
                        //队列文件处理完毕后,处理相关的事情
                    },
                    'Key': function(up, file) {
                        // 若想在前端对每个文件的key进行个性化处理，可以配置该函数
                        // 该配置必须要在 unique_names: false , save_key: false 时才生效
                        var key = "";
                        // do something with key here
                        return key
                    }
                }
            });
            // domain 为七牛空间（bucket)对应的域名，选择某个空间后，可通过"空间设置->基本设置->域名设置"查看获取
            // uploader 为一个plupload对象，继承了所有plupload的方法，参考http://plupload.com/docs


        });
    </script>
</block>